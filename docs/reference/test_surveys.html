<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Test sampling design of multiple surveys using a stratified analysis — test_surveys • SimSurvey</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Test sampling design of multiple surveys using a stratified analysis — test_surveys"><meta property="og:description" content="This function allows a series of sampling design settings to
be set and tested on the simulated population. True population values are compared
to stratified estimates of abundance."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SimSurvey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/custom_closures.html">Custom closures</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PaulRegular/SimSurvey/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Test sampling design of multiple surveys using a stratified analysis</h1>
    <small class="dont-index">Source: <a href="https://github.com/PaulRegular/SimSurvey/blob/HEAD/R/test_surveys.R" class="external-link"><code>R/test_surveys.R</code></a></small>
    <div class="hidden name"><code>test_surveys.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function allows a series of sampling design settings to
be set and tested on the simulated population. True population values are compared
to stratified estimates of abundance.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">test_surveys</span><span class="op">(</span>
  <span class="va">sim</span>,
  surveys <span class="op">=</span> <span class="fu"><a href="expand_surveys.html">expand_surveys</a></span><span class="op">(</span><span class="op">)</span>,
  keep_details <span class="op">=</span> <span class="fl">1</span>,
  n_sims <span class="op">=</span> <span class="fl">1</span>,
  n_loops <span class="op">=</span> <span class="fl">100</span>,
  cores <span class="op">=</span> <span class="fl">2</span>,
  export_dir <span class="op">=</span> <span class="cn">NULL</span>,
  length_group <span class="op">=</span> <span class="st">"inherit"</span>,
  alk_scale <span class="op">=</span> <span class="st">"division"</span>,
  progress <span class="op">=</span> <span class="cn">TRUE</span>,
  <span class="va">...</span>
<span class="op">)</span>

<span class="fu">resume_test</span><span class="op">(</span>export_dir <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>sim</dt>
<dd><p>Simulation from <code><a href="sim_distribution.html">sim_distribution</a></code>.</p></dd>
<dt>surveys</dt>
<dd><p>A data.frame or data.table with a sequence of surveys and their settings
with a format like the data.table returned by <code><a href="expand_surveys.html">expand_surveys</a></code>.</p></dd>
<dt>keep_details</dt>
<dd><p>Survey and stratified analysis details are dropped here to minimize object
size. This argument allows the user to keep the details of one
survey by specifying the survey number in the data.frame supplied to <code>surveys</code>.</p></dd>
<dt>n_sims</dt>
<dd><p>Number of times to simulate a survey over the simulated population.
Requesting a large number of simulations here may max out your RAM.</p></dd>
<dt>n_loops</dt>
<dd><p>Number of times to run the <code><a href="sim_survey.html">sim_survey</a></code> function. Total
simulations run will be the product of <code>n_sims</code> and <code>n_loops</code>
arguments. Low numbers of <code>n_sims</code> and high numbers of <code>n_loops</code>
will be easier on RAM, but may be slower.</p></dd>
<dt>cores</dt>
<dd><p>Number of cores to use in parallel. More cores should speed up the process.</p></dd>
<dt>export_dir</dt>
<dd><p>Directory for exporting results as they are generated. Main use of the export
is to allow this process to pick up where <code>test_survey</code> left off by
calling <code>resume_test</code>. If NULL, nothing is exported.</p></dd>
<dt>length_group</dt>
<dd><p>Size of the length frequency bins for both abundance at length calculations
and age-length-key construction. By default this value is inherited from
the value defined in <code><a href="sim_abundance.html">sim_abundance</a></code> from the closure supplied to
<code>sim_length</code> ("inherit"). A numeric value can also be supplied, however,
a mismatch in length groupings will cause issues with <code><a href="strat_error.html">strat_error</a></code>
as true vs. estimated length groupings will be mismatched.</p></dd>
<dt>alk_scale</dt>
<dd><p>Spatial scale at which to construct and apply age-length-keys:
"division" or "strat".</p></dd>
<dt>progress</dt>
<dd><p>Display progress bar and messages?</p></dd>
<dt>...</dt>
<dd><p>Arguments passed on to <code><a href="sim_survey.html">sim_survey</a></code></p><dl><dt><code>q</code></dt>
<dd><p>Closure, such as <code><a href="sim_logistic.html">sim_logistic</a></code>, for simulating catchability at age
(returned values must be between 0 and 1)</p></dd>

    <dt><code>trawl_dim</code></dt>
<dd><p>Trawl width and distance (same units as grid)</p></dd>

    <dt><code>resample_cells</code></dt>
<dd><p>Allow resampling of sampling units (grid cells)? Setting to TRUE may introduce bias
because depletion is imposed at the cell level.</p></dd>

    <dt><code>binom_error</code></dt>
<dd><p>Impose binomial error? Setting to FALSE may introduce bias in stratified estimates
at older ages because of more frequent rounding to zero.</p></dd>

    <dt><code>min_sets</code></dt>
<dd><p>Minimum number of sets per strat</p></dd>

    <dt><code>age_sampling</code></dt>
<dd><p>Should age sampling be "stratified" (default) or "random"?</p></dd>

    <dt><code>age_length_group</code></dt>
<dd><p>Numeric value indicating the size of the length bins for stratified
age sampling. Ignored if <code>age_sampling = "random"</code>.</p></dd>

    <dt><code>age_space_group</code></dt>
<dd><p>Should age sampling occur at the "division" (default), "strat" or "set" spatial scale?
That is, age sampling can be spread across each "division", "strat" or "set"
in each year to a maximum number within each length bin (cap is defined using
the <code>age_cap</code> argument). Ignored if <code>age_sampling = "random"</code>.</p></dd>

  
</dl></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Adds a table of survey designs tested. Also adds details and summary
        stats of stratified estimate error to the <code>sim</code> list, ending with
<code>"_strat_error"</code> or <code>"_strat_error_stats"</code>. Error statistics
        includes mean error (<code>"ME"</code>), mean absolute error (<code>"MAE"</code>),
        mean squared error (<code>"MSE"</code>), and root mean squared error (<code>"RMSE"</code>).
        Also adds a sample size summary table (<code>"samp_totals"</code>) to the list.
        Survey and stratified analysis details are not kept to minimize object size.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Depending on the settings, <code>test_surveys</code> may take a long time to run.
The <code>resume_test</code> function is for resuming partial runs of <code>test_surveys</code>.
Note that progress bar time estimates will be biased here by previous completions.
<code>test_loop</code> is a helper function used in both <code>test_surveys</code> and
<code>resume_test</code>. CAUTION: while the dots construct is available in the <code>resume_test</code>
function, be careful adding arguments as it will change the simulation settings
if the arguments added were not specified in the initial <code>test_surveys</code> run.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code>
<span class="co"># \donttest{</span>
<span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_abundance.html">sim_abundance</a></span><span class="op">(</span>ages <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, years <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
           <span class="fu"><a href="sim_distribution.html">sim_distribution</a></span><span class="op">(</span>grid <span class="op">=</span> <span class="fu"><a href="make_grid.html">make_grid</a></span><span class="op">(</span>res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="expand_surveys.html">expand_surveys</a></span><span class="op">(</span>set_den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000</span>,
                          lengths_cap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span><span class="op">)</span>,
                          ages_cap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>

<span class="co">## This call runs 500 simulations of 8 different surveys over the same</span>
<span class="co">## population, and then runs a stratified analysis and compares true vs</span>
<span class="co">## estimated values. It may take a while to run.</span>
<span class="va">tests</span> <span class="op">&lt;-</span> <span class="fu">test_surveys</span><span class="op">(</span><span class="va">pop</span>, surveys <span class="op">=</span> <span class="va">surveys</span>, keep_details <span class="op">=</span> <span class="fl">1</span>,
                      n_sims <span class="op">=</span> <span class="fl">10</span>, n_loops <span class="op">=</span> <span class="fl">50</span>, cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span>
<span class="va">tests</span><span class="op">$</span><span class="va">total_strat_error</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">survey</span> <span class="op">==</span> <span class="fl">8</span>, <span class="va">sim</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html" class="external-link">plot_ly</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html" class="external-link">add_lines</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">~</span><span class="va">I_hat</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, name <span class="op">=</span> <span class="st">"estimated"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html" class="external-link">add_lines</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">~</span><span class="va">I</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"true"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html" class="external-link">layout</a></span><span class="op">(</span>xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span>,
           yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Abundance index"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="plot_trend.html">plot_total_strat_fan</a></span><span class="op">(</span><span class="va">tests</span>, surveys <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>
<span class="fu"><a href="plot_trend.html">plot_length_strat_fan</a></span><span class="op">(</span><span class="va">tests</span>, surveys <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>
<span class="fu"><a href="plot_trend.html">plot_age_strat_fan</a></span><span class="op">(</span><span class="va">tests</span>, surveys <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>
<span class="fu"><a href="plot_trend.html">plot_age_strat_fan</a></span><span class="op">(</span><span class="va">tests</span>, surveys <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, select_by <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span>

<span class="fu"><a href="plot_trend.html">plot_error_surface</a></span><span class="op">(</span><span class="va">tests</span>, plot_by <span class="op">=</span> <span class="st">"rule"</span><span class="op">)</span>
<span class="fu"><a href="plot_trend.html">plot_error_surface</a></span><span class="op">(</span><span class="va">tests</span>, plot_by <span class="op">=</span> <span class="st">"samples"</span><span class="op">)</span>

<span class="fu"><a href="plot_trend.html">plot_survey_rank</a></span><span class="op">(</span><span class="va">tests</span>, which_strat <span class="op">=</span> <span class="st">"length"</span><span class="op">)</span>
<span class="fu"><a href="plot_trend.html">plot_survey_rank</a></span><span class="op">(</span><span class="va">tests</span>, which_strat <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span>

<span class="co"># }</span>

</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Paul Regular.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

